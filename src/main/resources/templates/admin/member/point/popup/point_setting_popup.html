<div id="point_setting_popup" class="popup bg" data-open-type="">
    <div class="popup-body big">
        <div class="popup-inner lined">
            <div class="popup-cont">
                <a href="javascript:;" class="popup-close" onclick="closePopup();"></a>
                <div class="pop-tit">
                    <h2>포인트 설정</h2>
                </div>
                <form action="/admin/point/member/update/point/settings" method="post">
                    <div class="tab-box3" id="member_authorizations_field">
                    </div>
                    <div class="tbl_area">
                        <div class="tbl_box tbl_box2">
                            <table>
                                <caption>목록</caption>
                                <colgroup>
                                    <col width="135px">
                                    <col width="*">
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th>상품 주문 시</th>
                                    <td>
                                        총 결제금액 &nbsp;<input type="text" class="wid100_px" id="point_order_rate" name="when_order_rate"> %
                                    </td>
                                </tr>
                                <tr>
                                    <th>후기 작성 시</th>
                                    <td>
                                        상품금액의 &nbsp;<input type="text" class="wid100_px" id="point_review_rate" name="when_review_rate"> %
                                    </td>
                                </tr>
                                <tr>
                                    <th>첫 회원가입 시</th>
                                    <td class="input-td">
                                        <input type="text" class="wid100_px" id="point_signup" name="when_signup"> 원
                                    </td>
                                </tr>
                                <tr>
                                    <th>추천인 ID 지정 시</th>
                                    <td class="input-td">
                                        <input type="text" class="wid100_px" id="point_recommended" name="when_recommended"> 원
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="btnBox">
                        <button type="submit" class="main_bg btn">저장</button>
                        <button type="button" class="border_bg btn" onclick="closePopup();">취소</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">

    const onChangeSettings = (_this) => {
        let row = _this.dataset;
        onPointSettingsChange(row);
    }

    const onPointSettingsChange = (row) => {
        $("#point_order_rate").val(row.when_order_rate?.toLocaleString());
        $("#point_review_rate").val(row.when_review_rate?.toLocaleString());
        $("#point_signup").val(row.when_signup?.toLocaleString());
        $("#point_recommended").val(row.when_recommended?.toLocaleString());
    }

    let member_authorizations = /*[[${member_authorizations}]]*/ [];
    let fields = $("#member_authorizations_field").empty();

    member_authorizations.forEach((row, index) => {
        let isFirst = !index;
        let checked = isFirst ? "checked" : "";
        fields.append(`
        <input type="radio" id="type_${row.idx}" name="idx" value="${row.idx}" ${checked}
        data-when_order_rate="${row.when_order_rate}"
        data-when_review_rate="${row.when_review_rate}"
        data-when_signup="${row.when_signup}"
        data-when_recommended="${row.when_recommended}"
        onchange="onChangeSettings(this);">
        <label for="type_${row.idx}">${row.name}</label>
        `);
        if(isFirst) {
            onPointSettingsChange(row);
        }
    });

</script>