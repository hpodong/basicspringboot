<!doctype html>
<html lang="kr" class="semi-dark">
<head th:replace="~{admin/includes/head.html}"></head>
<body>
<!--wrapper-->
<div id="bodyWrap">
    <!--sidebar wrapper -->
    <th:block th:insert="~{admin/includes/header.html}"/>
    <div id="sub" class="point-list">
        <div class="sub_visual">
            <div class="sub_tit">
                <h2 th:text="${cm.title}"></h2>
            </div>
            <form action="/admin/point/member/download/excel">
                <button class="btn border222 excel-btn"><img src="/admin/images/ico_download.svg" width="14">엑셀 다운로드</button>
                <input type="hidden" name="sd" th:value="${param?.sd}">
                <input type="hidden" name="ed" th:value="${param?.ed}">
                <input type="hidden" name="st" th:value="${param?.st}">
                <input type="hidden" name="mt" th:value="${param?.mt}">
                <input type="hidden" name="t" th:value="${param?.t}">
                <input type="hidden" name="q" th:value="${param?.q}">
            </form>
        </div>

        <!-- 본문 시작 -->
        <div class="sec_wrap">
            <div class="section section1">
                <div class="inner">
                    <div class="searchWrap">
                        <form id="searchForm" th:action="${cm.link}">
                            <table class="searchTable">
                                <caption> 게시글검색</caption>
                                <colgroup>
                                    <col width="10.3%">
                                    <col width="40%">
                                    <col width="10.3%">
                                    <col width="40%">
                                </colgroup>
                                <tbody>
                                <tr>
                                    <th>기간검색</th>
                                    <td>
                                        <div class="regist_date">
                                            <div class="calendar_wrap clear">
                                                <p class="calendar">
                                                    <input type="text" class="input datepicker" name="sd"
                                                           readonly="readonly" th:value="${param.sd}">
                                                    <span class="calendar_ico"><img
                                                            src="/admin/images/ico_calendar.svg"></span>
                                                </p>
                                                <span>~</span>
                                                <p class="calendar">
                                                    <input type="text" class="input datepicker" name="ed"
                                                           readonly="readonly" th:value="${param.ed}">
                                                    <span class="calendar_ico"><img
                                                            src="/admin/images/ico_calendar.svg"></span>
                                                </p>
                                            </div>
                                            <div class="period">
                                                <!-- 기간 클릭했을때 class="on" 추가 부탁드립니다. -->
                                                <input type="button" value="금일" class="month_btn">
                                                <input type="button" value="1개월" class="month_btn">
                                                <input type="button" value="3개월" class="month_btn">
                                                <input type="button" value="6개월" class="month_btn">
                                                <input type="button" value="1년" class="month_btn">
                                            </div>
                                        </div>
                                    </td>
                                    <th>검색조건</th>
                                    <td colspan="3">
                                        <div class="srch_word">
                                            <div class="wte_word clear flex-box">
                                                <select name="st" class="select_drop wid100">
                                                    <option value="">유형</option>
                                                    <option th:each="row:${statuses}" th:text="${row.toHtml()}" th:value="${row.getValue()}"></option>
                                                </select>
                                                <select name="mt" class="select_drop wid100">
                                                    <option value="">회원구분</option>
                                                    <option th:each="row:${authorizations}" th:value="${row.idx}" th:text="${row.name}"></option>
                                                    <!--<option value="1">가맹점</option>-->
                                                </select>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <th>검색어</th>
                                    <td colspan="3">
                                        <div class="srch_word">
                                            <div class="wte_word clear">
                                                <input type="hidden" name="t">
                                                <input type="text" name="q" class="" th:value="${param.q}" placeholder="회원명, 아이디, 사업자등록번호">
                                            </div>
                                            <div class="btn_box btn_box2 clear">
                                                <input type="submit" value="검색" class="btn_search">
                                                <input type="reset" value="초기화" class="btn_search">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <input type="hidden" name="p" id="page" th:value="${data.curPage}">
                        </form>
                    </div>
                    <!-- //search_warp -->
                    <form th:action="${cm.link + '/delete'}" class="form-inline" method="post"
                          onsubmit="return deleteCheck(this);">
                        <div class="tbl_area">
                            <div class="flex-box justify-content-between align-items-end tbl_tit_wrap">
                                <div class="tbl_tit">
                                    총 회원 보유포인트 수 <strong th:text="${#numbers.formatInteger(all_point, 1, 'COMMA')}"></strong><em>원</em> /
                                    소멸예정포인트 <strong th:text="${#numbers.formatInteger(expire_point, 1, 'COMMA')}"></strong>원<span class="fs14 fw500 cr999"> (30일 이내)</span>
                                    <!--<span>(<i
                                        th:text="${data.curPage}"></i>/<i th:text="${data.lastPage}"></i> 페이지)</span>-->
                                </div>
                                <a href="javascript:;" class="btn-primary btn point-sett-btn" onclick="openPopup('#point_setting_popup', 'normal')">포인트 설정</a>
                            </div>
                            <div class="scroll_list_wrap">
                                <div class="tbl_box tbl_box5">
                                    <table>
                                        <caption>목록</caption>
                                        <colgroup>
                                            <col width="70px"/>
                                            <col width="100px"/>
                                            <col width="20%"/>
                                            <col width="8%"/>
                                            <col width="*"/>
                                            <col width="10%"/>
                                            <col width="8%"/>
                                        </colgroup>
                                        <thead>
                                        <tr>
                                            <th scope="col">No</th>
                                            <th scope="col">회원구분</th>
                                            <th scope="col">회원명</th>
                                            <th scope="col">유형</th>
                                            <th scope="col">내용</th>
                                            <th scope="col">액수</th>
                                            <th scope="col">발생일시</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr th:if="${data.count == 0}">
                                            <td colspan="7">포인트내역 항목이 없습니다.</td>
                                        </tr>
                                        <tr th:if="${data.count != 0}" th:each="row: ${data.list}">
                                            <td th:data-popup-idx="${row.member_idx}" th:text="${row.row_num}"></td>
                                            <td th:data-popup-idx="${row.member_idx}" th:text="${row.member?.authorization?.name}"></td>
                                            <td th:data-popup-idx="${row.member_idx}" th:text="${row.member?.name}" class="txt-l"></td>
                                            <!--

                                                유형에 따라 클래스 변경 부탁드립니다

                                                적립 lightsky-txt
                                                사용 green-txt
                                                만료 cr999
                                                차감 txt-red

                                            -->
                                            <td th:data-popup-idx="${row.member_idx}" th:class="${row.status.toClass()}" th:text="${row.status.toHtml()}"></td>
                                            <td th:data-popup-idx="${row.member_idx}" th:text="${row.description}" class="txt-l"></td>

                                            <!--
                                                액수 클래스 변경 부탁드립니다

                                                액수가 +일시 txt-blue
                                                액수가 -일시 txt-red

                                            -->
                                            <td th:data-popup-idx="${row.member_idx}" th:class="'txt_r '+${row.priceToClass()}" th:text="${row.numberToString(row.value)+'원'}"></td>
                                            <td th:data-popup-idx="${row.member_idx}" th:text="${#dates.format(row.created_at, 'yyyy-MM-dd')}"></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </form>
                    <th:block th:insert="~{admin/includes/page_nation.html}"></th:block>
                </div>
            </div>
        </div>
    </div>
    <th:block th:insert="~{admin/includes/footer.html}"/>
    <th:block th:insert="~{admin/member/point/popup/point_setting_popup.html}"/>
</div>
<!--end wrapper-->
<!--start switcher-->
<script src="/admin/js/index.js" type="text/javascript"></script>
<script>
    const deleteCheck = (form) => {
        let count = $(form).find("input[name='idx']:checked").length;
        if (!count) {
            SGAlert({
                title: "선택된 항목이 없습니다.",
                type: SGAlertType.ERROR
            })
        } else {
            SGConfirm({
                title: `${count}개의 항목을 삭제하시겠습니까?`,
                type: SGAlertType.QUESTION,
                onsuccess: (res) => {
                    if (res) form.submit();
                }
            })
        }
        return false;
    }
</script>
</body>
</html>